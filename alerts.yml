groups:
  - name: bid-platform
    rules:
#      - alert: InstanceDown
#        expr: up == 0
#        for: 1m
#        labels: { severity: critical }
#        annotations:
#          summary: "Instance down: {{ $labels.instance }}"

      - alert: High5xxErrorRate
        expr: (
          sum(rate(http_requests_total{status=~"5.."}[1m]))
          / clamp_min(sum(rate(http_requests_total[1m])), 1e-12)) > 0.05
        for: 1m
        labels: { severity: warning }
        annotations:
          summary: "5xx > 5% ({{ $labels.service }})"

      - alert: PanicsDetected
        expr: sum(rate(http_panics_total[1m])) > 0
        for: 0m
        labels: { severity: critical }
        annotations:
          summary: "Panics detected ({{ $labels.service }})"

      - alert: HighLatencyP99
        expr: histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket[5m]))) > 0.5
        for: 2m
        labels: { severity: warning }
        annotations:
          summary: "p99 > 500ms ({{ $labels.service }})"
